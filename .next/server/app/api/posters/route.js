"use strict";(()=>{var e={};e.id=143,e.ids=[143],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1017:e=>{e.exports=require("path")},2017:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>$,patchFetch:()=>D,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>y,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{POST:()=>g});var o=r(9303),i=r(8716),s=r(670),u=r(7070),a=r(1617);async function c(e){let t=await l(e);return t&&"object"==typeof t&&"string"==typeof t.moments&&"string"==typeof t.xiaohongshu&&"string"==typeof t.summary&&t.moments.length>0&&t.xiaohongshu.length>0&&t.summary.length>0?t:(console.warn("æ¨¡åž‹è¿”å›žæ ¼å¼æ— æ•ˆï¼Œä½¿ç”¨æ¨¡æ¿å…œåº•"),d(e))}async function l(e){let t=function(e){let t=e.is_ecnu?`åŽä¸œå¸ˆèŒƒå¤§å­¦ ${e.location}`:e.location,r=p(e.time);return`
æ´»åŠ¨åç§°ï¼š${e.title}
æ—¶é—´ï¼š${r}
åœ°ç‚¹ï¼š${t}
ä¸»åŠžæ–¹ï¼š${e.organizer}
${e.description?`æ´»åŠ¨ç®€ä»‹ï¼š${e.description}`:""}
${e.join_url?`æŠ¥åé“¾æŽ¥ï¼š${e.join_url}`:""}

è¯·ä¸ºè¿™ä¸ªæ´»åŠ¨ç”Ÿæˆæœ‹å‹åœˆã€å°çº¢ä¹¦ã€ä¸€å¥è¯ä¸‰ç§æ–‡æ¡ˆã€‚
`}(e);try{let e=await fetch("/api/copy-model",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:t})});if(!e.ok)throw Error("æ¨¡åž‹è°ƒç”¨å¤±è´¥");return(await e.json()).copies}catch(e){throw console.error("æ¨¡åž‹è°ƒç”¨é”™è¯¯:",e),e}}function p(e){let t=new Date(e),r=t.getMonth()+1,n=t.getDate(),o=["å‘¨æ—¥","å‘¨ä¸€","å‘¨äºŒ","å‘¨ä¸‰","å‘¨å››","å‘¨äº”","å‘¨å…­"][t.getDay()],i=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0");return`${r}æœˆ${n}æ—¥ ${o} ${i}:${s}`}function d(e){let t;let r=e.is_ecnu?`åŽä¸œå¸ˆèŒƒå¤§å­¦ ${e.location}`:e.location,n=p(e.time);return{moments:(function(e){let t=new Date(e),r=t.getMonth()+1,n=t.getDate()}(e.time),function(e,t,r){let n=e.description?.includes("åˆ†äº«")?"\uD83C\uDFA4":e.description?.includes("æ¯”èµ›")?"\uD83C\uDFC6":e.description?.includes("å·¥ä½œåŠ")?"\uD83D\uDCA1":"\uD83C\uDF89",o=`${n} ${e.title}
ðŸ“… ${t}
ðŸ“ ${r}`;return e.organizer&&(o+=`
ðŸ‘¥ ${e.organizer}`),e.join_url&&(o+=`
ðŸ”— æŠ¥åæˆ³â†’`),o}(e,n,r)),xiaohongshu:function(e,t,r,n){let o=e.description?.includes("åˆ†äº«")?"\uD83C\uDFA4":e.description?.includes("æ¯”èµ›")?"\uD83C\uDFC6":e.description?.includes("å·¥ä½œåŠ")?"\uD83D\uDCA1":"âœ¨",i=`${o} ${e.title}

`;return i+=`ðŸ“… ${t}
ðŸ“ ${r}
`,e.organizer&&(i+=`ðŸ‘¤ ä¸»åŠžï¼š${e.organizer}
`),e.description&&(i+=`
${e.description}
`),e.join_url&&(i+=`
ðŸ’» æŠ¥åé“¾æŽ¥å·²æ”¾åœ¨è¯„è®ºåŒº~
`),i+=`
#æ ¡å›­æ´»åŠ¨ #ç¤¾å›¢ #å¤§å­¦ç”Ÿæ´»`}(e,n,r,0),summary:(t=`${e.title}ï¼Œ${n} ${r}`,e.organizer&&(t+=`ï¼Œ${e.organizer}`),t+"ã€‚")}}async function g(e){try{let t;let{title:r,time:n,location:o,organizer:i,description:s,join_url:l,is_ecnu:p}=await e.json();if(!r||!n||!o||!i)return u.NextResponse.json({error:"ç¼ºå°‘å¿…å¡«å­—æ®µ"},{status:400});let g=(0,a.uM)({title:r,time:n,location:o,organizer:i,description:s,join_url:l,is_ecnu:p||!1});try{t=await c({title:r,time:n,location:o,organizer:i,description:s,join_url:l,is_ecnu:p}),(0,a.Ih)(g,JSON.stringify(t))}catch(e){console.error("æ–‡æ¡ˆç”Ÿæˆå¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ¿å…œåº•:",e),t=d({title:r,time:n,location:o,organizer:i,description:s,join_url:l,is_ecnu:p}),(0,a.Ih)(g,JSON.stringify(t))}return u.NextResponse.json({id:g,copies:t})}catch(e){return console.error("åˆ›å»ºå¤±è´¥:",e),u.NextResponse.json({error:"åˆ›å»ºå¤±è´¥"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/posters/route",pathname:"/api/posters",filename:"route",bundlePath:"app/api/posters/route"},resolvedPagePath:"C:\\Users\\dou12\\Desktop\\ä¹”é’°æˆ\\åŽä¸œå¸ˆèŒƒå¤§å­¦\\å¤§ä¸€\\programming\\trae\\app\\api\\posters\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:m,serverHooks:y}=f,$="/api/posters/route";function D(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:m})}},1617:(e,t,r)=>{let n,o;r.d(t,{uM:()=>g,Qk:()=>f,iW:()=>h,Ih:()=>m});let i=require("fs");var s=r.n(i),u=r(1017),a=r.n(u);let c=require("node:crypto"),l=a().join(process.cwd(),"posters.json");function p(){if(!s().existsSync(l))return{};try{let e=s().readFileSync(l,"utf-8");return JSON.parse(e)}catch{return{}}}function d(e){s().writeFileSync(l,JSON.stringify(e,null,2))}function g(e){let t=p(),r=function(e=21){var t;t=e|=0,!n||n.length<t?(n=Buffer.allocUnsafe(128*t),c.webcrypto.getRandomValues(n),o=0):o+t>n.length&&(c.webcrypto.getRandomValues(n),o=0),o+=t;let r="";for(let t=o-e;t<o;t++)r+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&n[t]];return r}(8);return t[r]={...e,id:r,created_at:new Date().toISOString()},d(t),r}function f(e){return p()[e]||null}function h(e,t){let r=p();r[e]&&(r[e].poster_base64=t,d(r))}function m(e,t){let r=p();r[e]&&(r[e].copies=t,d(r))}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(2017));module.exports=n})();